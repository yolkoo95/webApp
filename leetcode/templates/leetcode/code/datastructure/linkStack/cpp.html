<pre>

  <small class="text-muted"><a>1  </a></small><span class="cm">/* linkStack.h */</span>
  <small class="text-muted"><a>2  </a></small><span class="cp">#ifndef linkStack_h</span>
  <small class="text-muted"><a>3  </a></small><span class="cp">#define linkStack_h</span>
  <small class="text-muted"><a>4  </a></small>
  <small class="text-muted"><a>5  </a></small><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>6  </a></small><span class="cp">#include</span> <span class="cpf">&lt;cassert&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>7  </a></small><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>8  </a></small><span class="cp">#include</span> <span class="cpf">&quot;node.h&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>9  </a></small><span class="cp">#include</span> <span class="cpf">&quot;node.cc&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>10  </a></small>
  <small class="text-muted"><a>11  </a></small><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
  <small class="text-muted"><a>12  </a></small><span class="k">class</span> <span class="nc">LinkStack</span> <span class="p">{</span>
  <small class="text-muted"><a>13  </a></small>    <span class="k">friend</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
  <small class="text-muted"><a>14  </a></small><span class="k">public</span><span class="o">:</span>
  <small class="text-muted"><a>15  </a></small>    <span class="n">LinkStack</span><span class="p">()</span>
  <small class="text-muted"><a>16  </a></small>        <span class="o">:</span><span class="n">top_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">size_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <small class="text-muted"><a>17  </a></small>    <span class="p">{}</span>
  <small class="text-muted"><a>18  </a></small>    <span class="k">virtual</span> <span class="o">~</span><span class="n">LinkStack</span><span class="p">()</span> <span class="p">{</span>
  <small class="text-muted"><a>19  </a></small>        <span class="n">clear</span><span class="p">();</span>
  <small class="text-muted"><a>20  </a></small>        <span class="n">top_</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <small class="text-muted"><a>21  </a></small>    <span class="p">}</span>
  <small class="text-muted"><a>22  </a></small>
  <small class="text-muted"><a>23  </a></small>    <span class="kt">int</span> <span class="n">size</span><span class="p">();</span>
  <small class="text-muted"><a>24  </a></small>    <span class="kt">int</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <small class="text-muted"><a>25  </a></small>    <span class="kt">void</span> <span class="nf">Push</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">element</span><span class="p">);</span>
  <small class="text-muted"><a>26  </a></small>    <span class="k">const</span> <span class="n">T</span> <span class="nf">Pop</span><span class="p">();</span>
  <small class="text-muted"><a>27  </a></small>    <span class="k">const</span> <span class="n">T</span> <span class="nf">GetTopElement</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <small class="text-muted"><a>28  </a></small>    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">GetTopPointer</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <small class="text-muted"><a>29  </a></small>    <span class="kt">void</span> <span class="nf">Traverse</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">visit</span><span class="p">);</span>
  <small class="text-muted"><a>30  </a></small>
  <small class="text-muted"><a>31  </a></small>    <span class="c1">// F means function type which is allowed to be implemented on the stack</span>
  <small class="text-muted"><a>32  </a></small>    <span class="k">using</span> <span class="n">F</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
  <small class="text-muted"><a>33  </a></small>    <span class="n">LinkStack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;*</span> <span class="n">Map</span><span class="p">(</span><span class="n">F</span> <span class="n">visit</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <small class="text-muted"><a>34  </a></small>
  <small class="text-muted"><a>35  </a></small><span class="k">private</span><span class="o">:</span>
  <small class="text-muted"><a>36  </a></small>    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">top_</span><span class="p">;</span>
  <small class="text-muted"><a>37  </a></small>    <span class="kt">int</span> <span class="n">size_</span><span class="p">;</span>
  <small class="text-muted"><a>38  </a></small>
  <small class="text-muted"><a>39  </a></small>    <span class="kt">bool</span> <span class="nf">isEmpty</span><span class="p">();</span>
  <small class="text-muted"><a>40  </a></small>    <span class="kt">void</span> <span class="nf">clear</span><span class="p">();</span>
  <small class="text-muted"><a>41  </a></small>
  <small class="text-muted"><a>42  </a></small>    <span class="c1">// We disallow copy a LinkStack</span>
  <small class="text-muted"><a>43  </a></small>    <span class="n">LinkStack</span><span class="p">(</span><span class="k">const</span> <span class="n">LinkStack</span><span class="o">&amp;</span><span class="p">);</span>
  <small class="text-muted"><a>44  </a></small>    <span class="k">const</span> <span class="n">LinkStack</span><span class="o">&amp;</span> <span class="k">operator</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">LinkStack</span><span class="o">&amp;</span><span class="p">);</span>
  <small class="text-muted"><a>45  </a></small><span class="p">};</span>
  <small class="text-muted"><a>46  </a></small>
  <small class="text-muted"><a>47  </a></small><span class="c1">// We put implement files (*.cc) of template.h (LinkStack.h, Node.h etc.) into TemplateClass directory(Note: Blue means this DIR isn&#39;t included in the Xcode workspace).</span>
  <small class="text-muted"><a>48  </a></small><span class="c1">// #include &quot;./TemplateClass/LinkStack.cc&quot;</span>
  <small class="text-muted"><a>49  </a></small>
  <small class="text-muted"><a>50  </a></small><span class="cp">#endif</span>
  <small class="text-muted"><a>51  </a></small>
  <small class="text-muted"><a>52  </a></small><span class="cm">/* linkStack.cc */</span> 
  <small class="text-muted"><a>53  </a></small><span class="cp">#include</span> <span class="cpf">&quot;linkStack.h&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>54  </a></small>
  <small class="text-muted"><a>55  </a></small><span class="cm">/* unittest.h */</span> 
  <small class="text-muted"><a>56  </a></small><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>57  </a></small><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>58  </a></small><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>59  </a></small><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
  <small class="text-muted"><a>60  </a></small><span class="cp">#include</span> <span class="cpf">&quot;entry.h&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>61  </a></small><span class="cp">#include</span> <span class="cpf">&quot;entry.cc&quot; // Some common functions has been defined in this file, bad bahavior</span><span class="cp"></span>
  <small class="text-muted"><a>62  </a></small><span class="cp">#include</span> <span class="cpf">&quot;linkStack.h&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>63  </a></small><span class="cp">#include</span> <span class="cpf">&quot;linkStack.cc&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>64  </a></small>
  <small class="text-muted"><a>65  </a></small><span class="cp">#include</span> <span class="cpf">&quot;gtest/gtest.h&quot;</span><span class="cp"></span>
  <small class="text-muted"><a>66  </a></small><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
  <small class="text-muted"><a>67  </a></small>
  <small class="text-muted"><a>68  </a></small><span class="k">namespace</span> <span class="p">{</span>
  <small class="text-muted"><a>69  </a></small>    <span class="k">class</span> <span class="nc">StackTest</span> <span class="o">:</span> <span class="k">public</span> <span class="n">testing</span><span class="o">::</span><span class="n">Test</span> <span class="p">{</span>
  <small class="text-muted"><a>70  </a></small>    <span class="k">protected</span><span class="o">:</span>
  <small class="text-muted"><a>71  </a></small>        <span class="k">virtual</span> <span class="kt">void</span> <span class="n">SetUp</span><span class="p">()</span> <span class="p">{</span>
  <small class="text-muted"><a>72  </a></small>            <span class="n">start_time_</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
  <small class="text-muted"><a>73  </a></small>        <span class="p">}</span>
  <small class="text-muted"><a>74  </a></small>
  <small class="text-muted"><a>75  </a></small>        <span class="k">virtual</span> <span class="kt">void</span> <span class="n">TearDown</span><span class="p">()</span> <span class="p">{</span>
  <small class="text-muted"><a>76  </a></small>            <span class="k">const</span> <span class="kt">time_t</span> <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
  <small class="text-muted"><a>77  </a></small>            <span class="n">EXPECT_TRUE</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time_</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;The test took too long.&quot;</span><span class="p">;</span>
  <small class="text-muted"><a>78  </a></small>        <span class="p">}</span>
  <small class="text-muted"><a>79  </a></small>
  <small class="text-muted"><a>80  </a></small>        <span class="c1">// Change age to double;</span>
  <small class="text-muted"><a>81  </a></small>        <span class="k">static</span> <span class="k">const</span> <span class="n">Entry</span><span class="o">&amp;</span> <span class="n">DoubleAgeInEntry</span><span class="p">(</span><span class="k">const</span> <span class="n">Entry</span><span class="o">&amp;</span> <span class="n">entry</span><span class="p">)</span> <span class="p">{</span>
  <small class="text-muted"><a>82  </a></small>            <span class="k">auto</span> <span class="n">en</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">Entry</span><span class="p">(</span><span class="n">entry</span><span class="p">));</span>
  <small class="text-muted"><a>83  </a></small>            <span class="n">en</span><span class="o">-&gt;</span><span class="n">SetEntry</span><span class="p">(</span><span class="n">en</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">(),</span> <span class="n">en</span><span class="o">-&gt;</span><span class="n">age</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>
  <small class="text-muted"><a>84  </a></small>            <span class="k">return</span> <span class="o">*</span><span class="n">en</span><span class="p">;</span>
  <small class="text-muted"><a>85  </a></small>        <span class="p">}</span>
  <small class="text-muted"><a>86  </a></small>
  <small class="text-muted"><a>87  </a></small>        <span class="kt">void</span> <span class="n">MapTester</span><span class="p">(</span><span class="k">const</span> <span class="n">LinkStack</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
  <small class="text-muted"><a>88  </a></small>            <span class="k">const</span> <span class="n">LinkStack</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;*</span> <span class="k">const</span> <span class="n">s_new</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">DoubleAgeInEntry</span><span class="p">);</span>
  <small class="text-muted"><a>89  </a></small>            <span class="c1">// Verifies that the new stack has the same size with s;</span>
  <small class="text-muted"><a>90  </a></small>            <span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">s_new</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">());</span>
  <small class="text-muted"><a>91  </a></small>
  <small class="text-muted"><a>92  </a></small>            <span class="c1">// Verifies whether Map() effects;</span>
  <small class="text-muted"><a>93  </a></small>            <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">GetTopPointer</span><span class="p">(),</span> <span class="n">p_new</span> <span class="o">=</span> <span class="n">s_new</span><span class="o">-&gt;</span><span class="n">GetTopPointer</span><span class="p">();</span> <span class="n">p</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">(),</span> <span class="n">p_new</span> <span class="o">=</span> <span class="n">p_new</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">())</span> <span class="p">{</span>
  <small class="text-muted"><a>94  </a></small>                <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">element</span><span class="p">().</span><span class="n">age</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">p_new</span><span class="o">-&gt;</span><span class="n">element</span><span class="p">().</span><span class="n">age</span><span class="p">());</span>
  <small class="text-muted"><a>95  </a></small>            <span class="p">}</span>
  <small class="text-muted"><a>96  </a></small>
  <small class="text-muted"><a>97  </a></small>            <span class="k">delete</span> <span class="n">s_new</span><span class="p">;</span>
  <small class="text-muted"><a>98  </a></small>        <span class="p">}</span>
  <small class="text-muted"><a>99  </a></small>
  <small class="text-muted"><a>100  </a></small>        <span class="n">LinkStack</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span> <span class="n">s0_</span><span class="p">;</span>
  <small class="text-muted"><a>101  </a></small>        <span class="n">LinkStack</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span> <span class="n">s1_</span><span class="p">;</span>
  <small class="text-muted"><a>102  </a></small>        <span class="n">LinkStack</span><span class="o">&lt;</span><span class="n">Entry</span><span class="o">&gt;</span> <span class="n">s2_</span><span class="p">;</span>
  <small class="text-muted"><a>103  </a></small>        <span class="kt">time_t</span> <span class="n">start_time_</span><span class="p">;</span>
  <small class="text-muted"><a>104  </a></small>    <span class="p">};</span>
  <small class="text-muted"><a>105  </a></small>
  <small class="text-muted"><a>106  </a></small>    <span class="n">TEST_F</span><span class="p">(</span><span class="n">StackTest</span><span class="p">,</span> <span class="n">StackInitializer</span><span class="p">)</span> <span class="p">{</span>
  <small class="text-muted"><a>107  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s0_</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <small class="text-muted"><a>108  </a></small>    <span class="p">}</span>
  <small class="text-muted"><a>109  </a></small>
  <small class="text-muted"><a>110  </a></small>    <span class="n">TEST_F</span><span class="p">(</span><span class="n">StackTest</span><span class="p">,</span> <span class="n">OperationTest</span><span class="p">)</span> <span class="p">{</span>
  <small class="text-muted"><a>111  </a></small>        <span class="n">Entry</span> <span class="n">en1</span><span class="p">(</span><span class="s">&quot;Donald Trump&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <small class="text-muted"><a>112  </a></small>        <span class="n">Entry</span> <span class="nf">en2</span><span class="p">(</span><span class="s">&quot;Quminzhi&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <small class="text-muted"><a>113  </a></small>        <span class="n">Entry</span> <span class="nf">en3</span><span class="p">(</span><span class="s">&quot;Taozhe&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <small class="text-muted"><a>114  </a></small>        <span class="n">s1_</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">en1</span><span class="p">);</span>
  <small class="text-muted"><a>115  </a></small>        <span class="n">s2_</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">en2</span><span class="p">);</span>
  <small class="text-muted"><a>116  </a></small>        <span class="n">s2_</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">en3</span><span class="p">);</span>
  <small class="text-muted"><a>117  </a></small>
  <small class="text-muted"><a>118  </a></small>        <span class="k">auto</span> <span class="n">del_element</span> <span class="o">=</span> <span class="n">s1_</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>
  <small class="text-muted"><a>119  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">en1</span><span class="p">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">del_element</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>
  <small class="text-muted"><a>120  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">en1</span><span class="p">.</span><span class="n">age</span><span class="p">(),</span> <span class="n">del_element</span><span class="p">.</span><span class="n">age</span><span class="p">());</span>
  <small class="text-muted"><a>121  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s1_</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <small class="text-muted"><a>122  </a></small>
  <small class="text-muted"><a>123  </a></small>        <span class="n">del_element</span> <span class="o">=</span> <span class="n">s2_</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>
  <small class="text-muted"><a>124  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">en3</span><span class="p">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">del_element</span><span class="p">.</span><span class="n">name</span><span class="p">());</span>
  <small class="text-muted"><a>125  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">en3</span><span class="p">.</span><span class="n">age</span><span class="p">(),</span> <span class="n">del_element</span><span class="p">.</span><span class="n">age</span><span class="p">());</span>
  <small class="text-muted"><a>126  </a></small>        <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">s2_</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
  <small class="text-muted"><a>127  </a></small>    <span class="p">}</span>
  <small class="text-muted"><a>128  </a></small>
  <small class="text-muted"><a>129  </a></small>    <span class="n">TEST_F</span><span class="p">(</span><span class="n">StackTest</span><span class="p">,</span> <span class="n">MapTest</span><span class="p">)</span> <span class="p">{</span>
  <small class="text-muted"><a>130  </a></small>        <span class="n">Entry</span> <span class="n">en1</span><span class="p">(</span><span class="s">&quot;Donald Trump&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <small class="text-muted"><a>131  </a></small>        <span class="n">Entry</span> <span class="nf">en2</span><span class="p">(</span><span class="s">&quot;Quminzhi&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <small class="text-muted"><a>132  </a></small>        <span class="n">Entry</span> <span class="nf">en3</span><span class="p">(</span><span class="s">&quot;Taozhe&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
  <small class="text-muted"><a>133  </a></small>        <span class="n">s1_</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">en1</span><span class="p">);</span>
  <small class="text-muted"><a>134  </a></small>        <span class="n">s2_</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">en2</span><span class="p">);</span>
  <small class="text-muted"><a>135  </a></small>        <span class="n">s2_</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">en3</span><span class="p">);</span>
  <small class="text-muted"><a>136  </a></small>
  <small class="text-muted"><a>137  </a></small>        <span class="n">MapTester</span><span class="p">(</span><span class="n">s0_</span><span class="p">);</span>
  <small class="text-muted"><a>138  </a></small>        <span class="n">MapTester</span><span class="p">(</span><span class="n">s1_</span><span class="p">);</span>
  <small class="text-muted"><a>139  </a></small>        <span class="n">MapTester</span><span class="p">(</span><span class="n">s2_</span><span class="p">);</span>
  <small class="text-muted"><a>140  </a></small>    <span class="p">}</span>
  <small class="text-muted"><a>141  </a></small><span class="p">}</span>

</pre>