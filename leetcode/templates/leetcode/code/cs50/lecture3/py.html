<pre>

  <small class="text-muted"><a>1  </a></small><span class="kn">import</span> <span class="nn">os</span>
  <small class="text-muted"><a>2  </a></small><span class="kn">import</span> <span class="nn">smtplib</span>
  <small class="text-muted"><a>3  </a></small><span class="kn">from</span> <span class="nn">email.header</span> <span class="kn">import</span> <span class="n">Header</span>
  <small class="text-muted"><a>4  </a></small><span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
  <small class="text-muted"><a>5  </a></small><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>
  <small class="text-muted"><a>6  </a></small>
  <small class="text-muted"><a>7  </a></small><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
  <small class="text-muted"><a>8  </a></small>
  <small class="text-muted"><a>9  </a></small><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>10  </a></small><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
  <small class="text-muted"><a>11  </a></small>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;index.html&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>12  </a></small>
  <small class="text-muted"><a>13  </a></small><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/register&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
  <small class="text-muted"><a>14  </a></small><span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
  <small class="text-muted"><a>15  </a></small>    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="c1"># if method is &#39;GET&#39;, xxx = request.args.get(&quot;xxx&quot;)</span>
  <small class="text-muted"><a>16  </a></small>    <span class="n">mail</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mail&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>17  </a></small>    <span class="n">dorm</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dorm&quot;</span><span class="p">)</span> <span class="c1"># if method is &#39;POST&#39;, xxx = request.form.get(&quot;xxx&quot;)</span>
  <small class="text-muted"><a>18  </a></small>    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">mail</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">dorm</span><span class="p">:</span>
  <small class="text-muted"><a>19  </a></small>        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;failure.html&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>20  </a></small>
  <small class="text-muted"><a>21  </a></small>    <span class="c1"># set third-part smtp server</span>
  <small class="text-muted"><a>22  </a></small>    <span class="n">mail_host</span> <span class="o">=</span> <span class="s2">&quot;smtp.163.com&quot;</span>
  <small class="text-muted"><a>23  </a></small>    <span class="n">from_account</span> <span class="o">=</span> <span class="s2">&quot;brysjhhrhl95@163.com&quot;</span>
  <small class="text-muted"><a>24  </a></small>    <span class="n">to_account</span> <span class="o">=</span> <span class="n">mail</span>
  <small class="text-muted"><a>25  </a></small>
  <small class="text-muted"><a>26  </a></small>    <span class="c1"># set message</span>
  <small class="text-muted"><a>27  </a></small>    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;Dear </span><span class="si">%s</span><span class="s2">, congratulate that you have registered successfully, and your information is as follow:</span><span class="se">\n\t</span><span class="s2">Name: </span><span class="si">%s</span><span class="se">\n\t</span><span class="s2">Email: </span><span class="si">%s</span><span class="se">\n\t</span><span class="s2">Dorm: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">dorm</span><span class="p">)</span>
  <small class="text-muted"><a>28  </a></small>    <span class="n">message</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># content, format, code</span>
  <small class="text-muted"><a>29  </a></small>    <span class="n">message</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Froshims Project&quot;</span>
  <small class="text-muted"><a>30  </a></small>    <span class="n">message</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_account</span>
  <small class="text-muted"><a>31  </a></small>    <span class="n">message</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_account</span>
  <small class="text-muted"><a>32  </a></small>
  <small class="text-muted"><a>33  </a></small>    <span class="c1"># check if get password from system, noting that password is authentic code of 163.com, not password for email!!!</span>
  <small class="text-muted"><a>34  </a></small>    <span class="n">pw</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>35  </a></small>    <span class="k">if</span> <span class="ow">not</span> <span class="n">pw</span><span class="p">:</span>
  <small class="text-muted"><a>36  </a></small>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;please export password in server&#39;s system environment.&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>37  </a></small>        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;fail to get password&quot;</span><span class="p">)</span>
  <small class="text-muted"><a>38  </a></small>
  <small class="text-muted"><a>39  </a></small>    <span class="k">try</span><span class="p">:</span>
  <small class="text-muted"><a>40  </a></small>        <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="n">mail_host</span><span class="p">,</span> <span class="mi">994</span><span class="p">)</span>
  <small class="text-muted"><a>41  </a></small>        <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">from_account</span> <span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">))</span>
  <small class="text-muted"><a>42  </a></small>        <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">from_account</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
  <small class="text-muted"><a>43  </a></small>        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;The mail has been sent successfully to </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">to_account</span><span class="p">))</span>
  <small class="text-muted"><a>44  </a></small>
  <small class="text-muted"><a>45  </a></small>        <span class="c1"># generate mail login page, noting &#39;https&#39; must be added when using &#39;&lt;a&gt;&#39; tag </span>
  <small class="text-muted"><a>46  </a></small>        <span class="n">mail_host_name</span> <span class="o">=</span> <span class="n">to_account</span><span class="p">[</span><span class="n">to_account</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="p">]</span>
  <small class="text-muted"><a>47  </a></small>        <span class="n">mail_login_page</span> <span class="o">=</span> <span class="s2">&quot;https://mail.&quot;</span> <span class="o">+</span> <span class="n">mail_host_name</span>
  <small class="text-muted"><a>48  </a></small>
  <small class="text-muted"><a>49  </a></small>        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;success.html&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="n">to_account</span><span class="p">,</span> <span class="n">email_login_page</span><span class="o">=</span><span class="n">mail_login_page</span><span class="p">)</span>
  <small class="text-muted"><a>50  </a></small>
  <small class="text-muted"><a>51  </a></small>    <span class="k">except</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTPException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <small class="text-muted"><a>52  </a></small>        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
  <small class="text-muted"><a>53  </a></small>        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;server_failure.html&quot;</span><span class="p">)</span>

</pre>